<!-- b8320889-fea6-4edb-8e8f-d975e6a831f0 a3c8bc91-f574-4255-a3d0-8d90f6030648 -->
# 完善弹道Entity ECS架构

## 问题分析

当前弹道Entity虽然能正常工作，但存在架构不完整的问题：

1. **缺少视图标识组件**: Entity本身没有保存PrefabId，只在事件中传递
2. **组件结构不统一**: 单位有UnitComponent，建筑有BuildingComponent，但弹道没有对应的标识组件
3. **缺少阵营信息**: 弹道有SourceCampId但没有CampComponent，不利于统一查询

## 实施方案

### 方案选择

**方案A（推荐）**: 为弹道添加 `UnitComponent`

- 优点：复用现有组件，PresentationSystem已支持
- 缺点：语义上弹道不完全是"单位"

**方案B**: 创建专门的 `ProjectileTagComponent`

- 优点：语义清晰，专门标记弹道
- 缺点：需要修改PresentationSystem来识别新组件

**采用方案A**，因为：

- UnitComponent包含PrefabId字段，正好满足需求
- PresentationSystem已经支持UnitComponent
- 改动最小，风险最低

### 实施步骤

#### 1. 修改 CombatSystem.FireProjectile

在 `Packages/ZLockstep/Runtime/Simulation/ECS/Systems/CombatSystem.cs`

为弹道Entity添加：

- `UnitComponent`（包含PrefabId=4，UnitType=100表示弹道）
- 可选：`CampComponent`（继承发射者阵营，便于统一查询）
```csharp
// 添加UnitComponent（包含视图标识）
ComponentManager.AddComponent(projectile, new UnitComponent
{
    UnitType = 100, // 100=弹道类型
    PrefabId = 4,   // 弹道预制体ID
    PlayerId = sourceCampId
});

// 添加Camp组件（可选，便于查询和碰撞检测）
ComponentManager.AddComponent(projectile, CampComponent.Create(sourceCampId));
```


#### 2. 调整弹道速度（可选）

如果弹道太快看不清，可以调慢速度：

- 当前: 20米/秒（10米距离约0.5秒）
- 建议: 8-10米/秒（10米距离约1-1.25秒）

#### 3. 验证 PresentationSystem 支持

确认 `Packages/ZLockstep/Runtime/View/Systems/PresentationSystem.cs`：

- ✅ 已监听 `UnitCreatedEvent`
- ✅ 通过 `UnitType` 或 `PrefabId` 查找预制体
- ✅ 创建ViewComponent并同步Transform

#### 4. 在 StandaloneBattleDemo 中配置弹道预制体

- 在Inspector的unitPrefabs数组索引4位置添加弹道预制体
- 如果暂时没有预制体，可以先留空（后续用代码动态创建简单可视化）

### 预期效果

完成后，弹道Entity将具备完整的ECS结构：

- ✅ `TransformComponent` - 空间位置
- ✅ `ProjectileComponent` - 弹道逻辑
- ✅ `VelocityComponent` - 运动速度
- ✅ `UnitComponent` - 视图标识（新增）
- ✅ `CampComponent` - 阵营归属（新增）
- ✅ `ViewComponent` - 表现层引用（PresentationSystem自动添加）

这样弹道Entity就与单位Entity保持一致的组件结构，符合ECS架构规范。

### To-dos

- [ ] 在 CombatSystem.FireProjectile 中为弹道Entity添加 UnitComponent 和 CampComponent
- [ ] 可选：调整弹道速度以便观察飞行过程
- [ ] 验证 PresentationSystem 能否正确处理弹道Entity
- [ ] 测试弹道在场景中的创建和飞行