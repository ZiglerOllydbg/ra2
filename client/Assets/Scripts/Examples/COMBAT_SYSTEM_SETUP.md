# 战斗系统配置完成

## 已实现的功能

### 1. AutoChaseSystem（自动追击系统）
- **位置**: `Assets/Scripts/Examples/AutoChaseSystem.cs`
- **功能**: 让所有有攻击能力的单位自动追击视野内的敌人
- **侦测范围**: 15 米（大于攻击范围 10 米）
- **更新频率**: 每秒评估一次
- **追击策略**: 
  - 优先继续追击当前攻击目标（如果有效）
  - 否则搜索最近的敌人
  - 只有在没有移动目标或已到达目标时才设置新目标

### 2. SimpleAISystem（AI系统）增强
- **位置**: `Assets/Scripts/Examples/SimpleAISystem.cs`
- **新功能**: 
  - 优先追逐 15 米范围内的玩家单位
  - 如果附近没有玩家单位，则移动到玩家基地
  - 跳过建筑，只追逐可移动单位

### 3. 系统注册
- **位置**: `Assets/Scripts/Examples/BattleGame.cs` 的 `RegisterSystems` 方法
- **注册顺序**:
  1. MovementSystem（移动系统）
  2. **AutoChaseSystem（自动追击系统）** ← 新增
  3. CombatSystem（战斗系统）
  4. ProjectileSystem（弹道系统）
  5. SimpleAISystem（AI系统）

## 测试说明

### 测试步骤

1. **启动场景**
   - 运行包含 `StandaloneBattleDemo` 组件的场景
   - 确保自动更新已开启（默认开启）

2. **创建双方单位**
   - 左键点击地面：创建己方坦克（蓝色，阵营0）
   - Q键 + 鼠标位置：创建AI坦克（红色，阵营1）

3. **测试自动战斗**
   
   **方法 1: 让单位自然接近**
   - 在地图中心附近创建一个己方坦克
   - 在附近（15米内）创建一个AI坦克
   - 观察它们会自动互相追击并开火

   **方法 2: 手动移动己方单位**
   - 创建多个己方坦克
   - 按 A 键选中所有己方单位
   - 创建一些AI坦克
   - 右键点击AI坦克附近，让己方单位靠近
   - 观察战斗开始

   **方法 3: 测试AI主动进攻**
   - 创建几个AI坦克
   - 在附近（15米内）创建己方坦克
   - AI坦克会自动追击己方单位

### 预期行为

1. **追击阶段**
   - 单位发现 15 米内的敌人
   - 单位开始移动追击敌人
   - 控制台日志显示：`[AutoChaseSystem]` 或 `[SimpleAISystem]` 的追击信息

2. **战斗阶段**
   - 当距离缩短到 10 米（攻击范围）内
   - CombatSystem 开始工作，单位发射弹道
   - 每 2 秒发射一次（攻击间隔）
   - 弹道以 20 米/秒速度飞向目标

3. **伤害阶段**
   - 弹道命中目标
   - 目标生命值减少 30 点（每次攻击）
   - 生命值为 0 时单位死亡

### 可视化工具

使用以下按键查看战斗细节：

- **H键**: 切换生命值显示
  - 绿色条：生命值 > 50%
  - 黄色条：生命值 25-50%
  - 红色条：生命值 < 25%

- **R键**: 切换攻击范围显示
  - 显示每个单位的攻击范围（10米圆圈）

- **Scene视图的Gizmos**: 
  - 查看单位位置、选中状态
  - 查看建筑占据的区域

### 参数配置

**坦克默认属性** (在 `BattleGame.CreateTank` 中定义):
- 生命值: 100
- 攻击力: 30
- 攻击范围: 10 米
- 攻击间隔: 2 秒
- 移动速度: 3 米/秒（可在 `StandaloneBattleDemo` 中配置）
- 碰撞半径: 0.5 米（可在 `StandaloneBattleDemo` 中配置）

**系统参数**:
- AutoChaseSystem 侦测范围: 15 米
- AutoChaseSystem 更新间隔: 1 秒
- SimpleAISystem 侦测范围: 15 米
- SimpleAISystem 更新间隔: 3 秒
- 弹道速度: 20 米/秒

## 调试信息

在控制台查看以下日志：

- `[AutoChaseSystem]`: 自动追击系统的日志（如果需要，可以在代码中取消注释）
- `[SimpleAISystem]`: AI系统的追击和移动日志
- `[CombatSystem]`: 战斗系统的攻击日志（如果需要，可以在代码中取消注释）
- `[StandaloneBattleDemo]`: Demo的操作日志

## 可能的问题排查

### 问题1: 单位不追击敌人
- 检查单位是否有 `AttackComponent`
- 检查单位是否有 `FlowFieldNavigatorComponent`
- 检查侦测范围（15米）是否足够大
- 确认单位阵营不同（campId 0 vs 1）

### 问题2: 单位追击但不攻击
- 检查距离是否在攻击范围内（10米）
- 检查攻击冷却时间（2秒间隔）
- 确认目标还活着（CurrentHealth > 0）

### 问题3: 弹道不命中
- 弹道是追踪型（isHoming = true）
- 检查目标是否移动过快
- 查看 `ProjectileSystem` 的更新逻辑

## 后续优化建议

1. **可配置参数**: 将侦测范围、攻击范围等参数暴露到 Inspector
2. **视觉反馈**: 添加攻击动画、音效
3. **单位分组**: 支持编队战斗
4. **智能追击**: 根据单位类型选择不同的追击策略
5. **区域防御**: 让单位在特定区域内巡逻和防御

