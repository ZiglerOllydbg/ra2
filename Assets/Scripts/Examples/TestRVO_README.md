# TestRVO 流场系统可视化测试工具

## 📖 概述

TestRVO 是一个完整的流场导航系统测试和可视化工具，提供了直观的IMGUI界面和实时Gizmos可视化，让你能够清楚地看到单位的导航、寻路和RVO避障过程。

## 🚀 快速开始

1. **在Unity场景中创建空对象**
2. **添加 TestRVO 组件**
3. **运行场景**
4. **点击 "初始化系统" 按钮**
5. **选择一个测试示例并观察**

## 🎮 IMGUI控制面板

### 1️⃣ 系统初始化
- **初始化系统**：创建zWorld、地图管理器和流场系统
- **重新初始化**：清理并重建整个系统
- 显示当前逻辑帧数

### 2️⃣ 运行测试示例

#### 示例1：编队移动
- 创建10个单位，以编队形式移动到同一目标
- 展示共享流场机制（10个单位只需要1个流场）

#### 示例2：多目标导航
- 创建20个单位分成4组，每组前往不同目标
- 展示多流场管理（4个独立流场）

#### 示例3：动态障碍物
- 单位移动过程中建造建筑
- 展示流场自动更新和路径重规划

#### 完整示例（自动运行）
- 自动运行300帧完整测试
- 包含单位创建、移动、动态障碍物等

### 3️⃣ 帧更新控制

#### 自动更新模式
- 勾选后自动以30FPS更新逻辑
- 适合观察单位持续移动

#### 手动更新模式
- **单步更新 (1帧)**：精确控制，逐帧调试
- **快进 (10帧)**：快速推进测试

### 4️⃣ 动态障碍物测试
- **建造建筑 (70,70)**：在指定位置建造15x10的建筑
- **摧毁建筑 (70,70)**：移除该建筑

### 5️⃣ 当前状态
实时显示：
- 当前逻辑帧数
- 场景中单位数量
- 首个单位的位置

### 6️⃣ 可视化选项
运行时动态切换显示内容：
- ☑️ 显示网格
- ☑️ 显示障碍物
- ☑️ 显示单位
- ☑️ 显示流场方向
- ☑️ 显示目标点

## 🎨 可视化效果说明

### 🟦 地图网格
- **灰色网格线**：可行走的地图格子
- **黄色边界**：地图边界
- **红色方块**：障碍物（建筑、墙壁等）

### 🎯 流场方向
- **彩色箭头**：每个格子的流场方向
  - 🟢 绿色：靠近目标（低代价）
  - 🟡 黄色：中等距离
  - 🔴 红色：远离目标（高代价）
- **黄色球体**：流场目标点
- 箭头密度可通过 `flowFieldDisplayInterval` 调整

### 🤖 单位显示
- **球体颜色表示状态：**
  - 🔵 青色：移动中
  - 🟢 绿色：已到达目标
  - ⚫ 灰色：导航未启用
- **线框圆**：单位的RVO碰撞半径
- **蓝色箭头**：当前速度方向

### 🎯 目标点
- **黄色线框球**：单位的移动目标
- **黄色竖线**：目标标记
- **半透明黄线**：从单位到目标的连线

## ⚙️ Inspector配置

### 测试配置
```csharp
Auto Update: false           // 是否自动更新
Auto Update Interval: 0.033  // 自动更新间隔（秒）
```

### 可视化配置
```csharp
Show Grid: true                      // 显示网格
Show Obstacles: true                 // 显示障碍物
Show Units: true                     // 显示单位
Show Flow Field: true                // 显示流场
Show Targets: true                   // 显示目标点
Unit Size: 0.5                       // 单位显示大小
Flow Field Arrow Size: 0.4           // 流场箭头大小
Flow Field Display Interval: 2       // 流场显示间隔
```

## 🎯 典型使用场景

### 场景1：调试单位寻路
1. 运行"示例1：编队移动"
2. 关闭自动更新
3. 使用"单步更新"逐帧观察单位如何沿着流场移动
4. 观察流场箭头颜色变化

### 场景2：观察RVO避障
1. 运行"示例2：多目标导航"
2. 启用自动更新
3. 观察单位之间如何互相避让
4. 注意单位的速度箭头（蓝色）如何变化

### 场景3：测试动态障碍
1. 运行"示例3：动态障碍物"
2. 等待单位开始移动
3. 点击"建造建筑"
4. 观察流场如何重新计算，单位如何绕路

### 场景4：性能测试
1. 运行"示例2：多目标导航"（20个单位）
2. 在状态面板观察帧数和单位数量
3. 可以关闭部分可视化选项提升性能
4. 观察多流场共享机制

## 📊 地图信息

- **逻辑地图大小**：256x256格（每格0.5单位）
- **流场地图大小**：128x128格（每格1.0单位）
- **世界坐标范围**：(0, 0) 到 (128, 128)
- **总面积**：128×128世界单位

**重要**：所有单位和目标的坐标必须在 (0, 0) 到 (128, 128) 范围内！

### 预设障碍物
- **地图边界**：完整包围
- **建筑1**：(50,50) - (60,60) 矩形
- **建筑2**：(100,80) - (115,88) 矩形
- **建筑3**：(150,150) 半径10圆形

## 🐛 调试技巧

1. **单位不移动？**
   - 检查是否点击了"初始化系统"
   - 检查是否运行了测试示例
   - 确保启用了自动更新或手动单步更新

2. **看不到可视化？**
   - 确保Scene视图已打开
   - 检查Gizmos按钮是否启用（Scene视图右上角）
   - 调整相机位置，俯视地图

3. **流场箭头太密集？**
   - 增加 `Flow Field Display Interval` 值
   - 或在运行时取消勾选"显示流场方向"

4. **性能问题？**
   - 减少 `Flow Field Display Interval`
   - 关闭部分可视化选项
   - 使用手动更新模式

## 💡 扩展建议

你可以在TestRVO基础上扩展：

1. **添加更多测试场景**：修改SetupObstacles方法
2. **自定义单位参数**：修改CreateNavigableUnit调用
3. **添加性能监控**：统计流场计算时间
4. **保存回放**：记录单位位置用于回放分析
5. **添加更多可视化**：如代价场热力图

## 📝 代码结构

```
TestRVO.cs
├── IMGUI界面 (OnGUI)
│   ├── 系统初始化控制
│   ├── 测试示例按钮
│   ├── 帧更新控制
│   ├── 动态障碍物测试
│   └── 可视化选项
└── Gizmos绘制 (OnDrawGizmos)
    ├── DrawGridAndObstacles()   - 网格和障碍物
    ├── DrawFlowFields()          - 流场方向箭头
    ├── DrawUnits()               - 单位和速度
    ├── DrawTargets()             - 目标点
    └── DrawArrow()               - 箭头辅助方法
```

## 🎓 学习建议

**初学者**：
1. 先运行"完整示例"，观察整个流程
2. 再运行"示例1"，使用单步更新理解流场原理
3. 逐一关闭可视化选项，理解每个元素的含义

**进阶用户**：
1. 修改示例代码，测试不同参数
2. 添加更多障碍物，测试复杂地形
3. 分析流场共享和更新机制

## 🔗 相关文档

- `FlowFieldExample.cs` - 流场系统使用示例
- `FLOW_FIELD_README.md` - 流场系统详细文档
- `SimpleMapManager.cs` - 地图管理器实现
- `FlowFieldCore.cs` - 流场核心算法

---

**作者提示**：这个工具的目的是帮助你理解流场导航系统的工作原理。建议多实验，观察不同场景下系统的表现！

