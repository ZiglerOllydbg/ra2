# RA2 游戏服务器通信协议

## 1. 概述

本文档描述了 RA2 游戏客户端与服务器之间的 WebSocket 通信协议。所有消息均使用 JSON 格式进行传输。

## 2. 消息格式

所有消息都遵循以下基本格式：

```json
{
  "type": "消息类型",
  "data": { /* 消息数据 */ }
}
```

其中：
- `type`: 字符串，表示消息类型
- `data`: 对象，包含具体的消息数据

## 3. 客户端到服务器的消息

### 3.1 匹配请求

客户端发送匹配请求，加入游戏匹配队列。

**消息格式：**
```json
{
  "type": "match",
  "data": {
    "name": "玩家名称",
    "roomType": "房间类型"  // 可选值: SOLO, DUO, TRIO, QUAD, OCTO
  }
}
```

**字段说明：**
- `name`: 玩家名称
- `roomType`: 房间类型（可选），默认为 DUO

### 3.2 准备就绪

玩家在房间中准备就绪。

**消息格式：**
```json
{
  "type": "ready"
}
```

### 3.3 帧输入数据

玩家发送游戏输入数据。

**消息格式：**
```json
{
  "type": "frameInput",
  "frame": 10,
  "data": [
    // 输入数据数组
  ]
}
```

**字段说明：**
- `frame`: 帧编号
- `data`: 输入数据数组

### 3.4 离开房间

玩家主动离开房间。

**消息格式：**
```json
{
  "type": "leave"
}
```

## 4. 服务器到客户端的消息

### 4.1 匹配确认

服务器确认收到匹配请求。

**消息格式：**
```json
{
  "type": "matched"
}
```

### 4.2 匹配成功

匹配成功，进入房间。

**消息格式：**
```json
{
  "type": "matchSuccess",
  "roomId": "房间ID",
  "yourCampId": 1,
  "yourToken": "玩家Token",
  "data": [
    {
      "campId": 1,
      "name": "玩家1"
    },
    {
      "campId": 2,
      "name": "玩家2"
    }
  ]
}
```

**字段说明：**
- `roomId`: 房间ID
- `yourCampId`: 自己的阵营ID
- `yourToken`: 玩家Token
- `data`: 房间内所有玩家信息列表

### 4.3 游戏开始

所有玩家准备就绪，游戏开始。

**消息格式：**
```json
{
  "type": "gameStart"
}
```

### 4.4 帧同步数据

服务器广播的帧同步数据。

**消息格式：**
```json
{
  "type": "frameSync",
  "frame": 10,
  "data": [
    {
      "campId": 1,
      "inputs": [
        // 玩家输入数据
      ]
    }
  ]
}
```

**字段说明：**
- `frame`: 帧编号
- `data`: 所有玩家的输入数据

## 5. 房间类型

支持以下房间类型：

| 类型  | 玩家数量 |
|-------|----------|
| SOLO  | 1        |
| DUO   | 2        |
| TRIO  | 3        |
| QUAD  | 4        |
| OCTO  | 8        |

## 6. 阵营ID

不同数量玩家的房间会分配不同的阵营ID：

- 1人房间：Red(1)
- 2人房间：Red(1), Blue(2)
- 3人房间：Red(1), Blue(2), Green(3)
- 4人房间：Red(1), Blue(2), Green(3), Yellow(4)
- 8人房间：Red(1), Blue(2), Green(3), Yellow(4), Orange(5), Purple(6), Pink(7), Brown(8)