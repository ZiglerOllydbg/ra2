
### **《红警》类游戏最小化核心循环 - 开发设计文档**

**文档版本：** 1.1
**目标：** 定义一个可玩、可扩展的实时战略游戏最小核心循环，聚焦于经济、生产和战斗的基本互动。

#### **1. 核心设计理念**

本设计围绕一个简单的“资源-电力-生产-扩张”循环构建：
1.  **采集资源（钱）** -> 2. **维持电力（能量）** -> 3. **生产单位（武力）** -> 4. **保护与扩张（循环强化）**

玩家通过此循环不断壮大自身，同时干扰或破坏对手的循环，从而取得胜利。

#### **2. 核心实体与系统**

##### **2.1 建筑系统**

所有建筑都继承自一个基础`Building`类，包含以下通用属性：
*   `生命值（Health）`
*   `建造价格（Cost）`
*   `电力负载（Power Drain）`：该建筑运行所需的电力。
*   `建造前提（Prerequisites）`：需要已存在的特定建筑才能解锁。

**核心建筑列表：**

1.  **建造厂（Construction Yard）**
    *   **角色：** 游戏的起点和核心。失去所有建造厂即失败。
    *   **功能：**
        *   是唯一可以展开并放置新建筑的建筑。
        *   可以自我收起重展开（以规避攻击）。
    *   **生产前提：** 游戏开始时拥有。

2.  **发电厂（Power Plant）**
    *   **角色：** 提供电力，维持经济与军事运转。
    *   **功能：**
        *   提供 `+100` 电力。
    *   **关键机制：电力系统**
        *   **总电力（Total Power）：** 所有发电厂提供的电力总和。
        *   **已用电力（Power Used）：** 所有建筑电力负载的总和。
        *   **状态：**
            *   **电力充足（>0）：** 所有建筑正常运作。
            *   **电力不足（<=0）：** 进入 **“电力短缺”** 状态。
                *   所有建筑工作速度（包括生产、建造、升级）大幅减缓（例如，降低至30%）。
                *   防御建筑（如哨戒炮）停止工作。
                *   地图迷雾（黑幕）重新覆盖未探索区域。

3.  **矿场（Ore Refinery）**
    *   **角色：** 资源收入的核心处理站。
    *   **功能：**
        *   为矿车提供卸载点，将矿石转换为资金。
        *   内置一个有限的资金存储空间（例如 $2000），存满后矿车将无法卸载，直到资金被花掉或存储上限提升。
    *   **生产前提：** 建造厂。

4.  **兵营（Barracks）**
    *   **角色：** 生产步兵单位。
    *   **功能：**
        *   解锁基础步兵单位的生产能力。
    *   **生产前提：** 发电厂。

5.  **战车工厂（War Factory）**
    *   **角色：** 生产装甲单位。
    *   **功能：**
        *   解锁矿车和战斗车辆单位的生产能力。
    *   **生产前提：** 兵营。

##### **2.2 资源系统**

1.  **资源类型：** 资金（Money）。
2.  **资源来源：** 矿石（Ore）。
    *   矿石以矿脉（Ore Vein）的形式散布在地图上，通常呈亮绿色。
    *   矿石可以被采集后再生，但再生速度较慢。
3.  **采集单位：** 矿车（Ore Truck）
    *   **行为AI（状态机）：**
        *   **空闲（Idle）：** 在矿场待命。
        *   **移动至矿石（MoveToOre）：** 自动寻找并驶向最近的矿石。
        *   **采集（Harvesting）：** 停在矿石上，经过 `X` 秒后装载完毕，模型显示为满载状态。
        *   **返回矿场（ReturnToRefinery）：** 自动返回所属矿场。
        *   **卸载（Unloading）：** 在矿场停留 `Y` 秒，将矿石转换为资金，增加玩家的资金总数。
    *   **生产前提：** 战车工厂。

##### **2.3 单位系统**

所有单位继承自基础`Unit`类，包含`生命值`、`移动速度`、`攻击力`、`攻击范围`等属性。

**基础单位列表：**

*   **兵营生产：**
    *   **动员兵（Conscript）**
        *   **角色：** 廉价、基础的反步兵单位。
        *   **能力：** 对地攻击。
*   **战车工厂生产：**
    *   **矿车（Ore Truck）**：如上所述。
    *   **犀牛坦克（Rhino Tank）**
        *   **角色：** 主力中型坦克，全能型单位。
        *   **能力：** 对地攻击，对建筑有效。

#### **3. 核心游戏循环流程**

**对于玩家的一次操作循环：**

1.  **初始状态：** 拥有一个建造厂、少量初始资金和一名工程师（或仅建造厂）。
2.  **经济扩张：**
    *   使用建造厂放置 **发电厂** 以提供电力。
    *   使用建造厂放置 **矿场** 以建立经济来源。
3.  **军事建设：**
    *   电力充足后，建造 **兵营**。
    *   建造 **战车工厂**。
4.  **单位生产与战斗：**
    *   从兵营生产动员兵，用于侦察和防御。
    *   从战车工厂生产矿车，加速经济循环。
    *   从战车工厂生产犀牛坦克，组成攻击力量。
5.  **循环与决策：**
    *   **监控电力：** 在建造新建筑或大规模生产单位前，确保电力充足。
    *   **平衡经济与军事：** 资金是用于生产更多矿车（长期投资）还是生产更多坦克（短期优势）？
    *   **地图控制：** 派单位去争夺地图上更富饶的矿脉。
    *   **攻击与防御：** 使用军事单位攻击敌人的矿车、矿场以切断其经济，或直接攻击其建造厂以赢得游戏。

#### **4. 技术实现要点**

*   **建筑放置系统：**
    *   需要实现一个“幽灵预览”系统，在放置前显示建筑轮廓。
    *   碰撞检测：建筑不能与其他建筑、单位或不可通过的地形重叠。
*   **寻路系统（Pathfinding）：**
    *   为所有地面单位实现A*算法，以在动态变化的地图（新建筑、单位）上导航。
*   **单位选择与编组：**
    *   支持框选、点选。
    *   支持Ctrl+数字键编组。
*   **经济与电力管理器：**
    *   需要一个全局管理器（GameManager）来实时计算和更新总资金、总电力和电力状态，并将状态广播给所有受影响的实体。
*   **AI（矿车）：**
    *   实现一个高效的状态机，让矿车能够自动寻找最近的可用矿石和返回最近的空闲矿场。

#### **5. 后续扩展方向**

此最小化循环是基石，可以轻松扩展：

*   **科技树：** 添加“作战实验室”等建筑，解锁高级单位（如飞机、超级武器）。
*   **第二阵营：** 设计一个拥有功能相似但机制不同的对立阵营（如盟军vs苏军）。
*   **海军与空军：** 增加新的建筑（船坞、机场）和单位类型。
*   **超级武器：** 添加核弹、闪电风暴等游戏终结者。
*   **地形与高度系统：** 引入高低差对攻击范围的影响。
*   **单位经验值与升级：** 让存活下来的单位变得更强。

---